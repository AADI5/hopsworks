<div ng-controller="KafkaCtrl as kafkaCtrl">
  <div ng-include="'nav.html'"></div>
  <div id="wrapper" class="toggled">
    <div class="overlay"></div>

    <div ng-include="'navProject.html'"></div>

    <section>
      <div class="content-wrapper">
        <!--<h3 id="projectBread" style="display: none;"> {{ projectCtrl.currentProject.projectName}} / Kafka</h3>-->
        <div growl reference="10" class="pull-right" ></div>

        <div>
          <form class="form-horizontal">
            <div class="form-group"  style="margin-left: 15px;">
              <div class="row">
                <div class="col-sm-1">
                  <button type="button" ng-disabled="kafkaCtrl.maxNumTopics - kafkaCtrl.numTopicsUsed <= 0" 
                          ng-click="kafkaCtrl.createTopic()" class="btn btn-default btn-success control-label">
                    New Topic<i style="margin-left: 10px" class="glyphicon glyphicon-plus">
                    </i> 
                  </button>
                </div>
                <div class="col-sm-2">
                  <input ng-disabled="kafkaCtrl.maxNumTopics - kafkaCtrl.numTopicsUsed <= 0" type="text" class="form-control" id="topicName" ng-model="kafkaCtrl.topicName" placeholder="New Topic Name">
                </div>
              </div>
              <div class="row">
                <div class="col-sm-2">
                  <span class="text-muted" ng-show="kafkaCtrl.maxNumTopics - kafkaCtrl.numTopicsUsed > 0">{{kafkaCtrl.numTopicsUsed}} of {{kafkaCtrl.maxNumTopics}} topics in use</span>
                  <span style="color: red;" class="text" ng-show="kafkaCtrl.maxNumTopics - kafkaCtrl.numTopicsUsed <= 0">All available {{kafkaCtrl.maxNumTopics}} topics are in use.</span>
                </div>
              </div>
            </div>
          </form>

          <table st-table="rowCollection" class="table table-striped">
            <thead>
              <tr>
                <th st-sort="topicName" class="col-sm-10">Topic Name</th>
                <th class="col-sm-1">Remove Topic</th>
                <th class="col-sm-1">Advanced</th>
              </tr>
            </thead>
            <tbody>
              <tr st-select-row="row" st-select-mode="single" ng-repeat="row in kafkaCtrl.topics">
                <td class="col-sm-10">
                  <div class="row" style="margin-left: 10px;">{{row.name}}</div>

                  <div class="col-sm-2">
                    <button style="margin-left: -20px" ng-show="row.isSelected" type="button" 
                            ng-click="kafkaCtrl.addAcl(row.id)" class="btn btn-default btn-success btn-block">
                      New ACL <i style="margin-left: 10px" class="glyphicon glyphicon-plus">
                      </i>
                    </button>
                  </div>
                  <br ng-show="row.isSelected">
                  <br ng-show="row.isSelected">
                  <table ng-if="row.isSelected" st-table="rowCollection" class="table table-striped col-sm-12">
                    <thead ng-show="row.acls.length > 0">
                      <tr>
                        <th class="col-sm-2">Username</th>
                        <th class="col-sm-2">Permission Type</th>
                        <th class="col-sm-2">Operation Type</th>
                        <th class="col-sm-2">Host</th>
                        <th class="col-sm-1">Role</th>
                        <th class="col-sm-1">Shared</th>
                        <th class="col-sm-1">Remove</th>
                        <th class="col-sm-1">Edit ACL</th>
                      </tr>
                    </thead>
                    <tr ng-repeat="acl in row.acls">
                      <td ng-if="kafkaCtrl.activeId === -1">{{acl.username}}</td>
                      <td ng-if="kafkaCtrl.activeId === acl.id"><input type="text" class="form-control" id="aclUsername" ng-model="kafkaCtrl.username" placeholder="Username"></td>
                      <td ng-if="kafkaCtrl.activeId === -1">{{acl.permission_type}}</td>
                      <td ng-if="kafkaCtrl.activeId === acl.id">
                        <select name="permission_type" ng-model="kafkaCtrl.permission_type">
                          <option value="read">read</option>
                          <option value="write">write</option>
                          <option value="details">details</option>
                          <option value="*">*</option>
                        </select>
                      </td>
                      <td ng-if="kafkaCtrl.activeId === -1">{{acl.operation_type}}</td>
                      <td ng-if="kafkaCtrl.activeId === acl.id">
                        <select name="operation_type" ng-model="kafkaCtrl.operation_type">
                          <option value="read">read</option>
                          <option value="write">write</option>
                          <option value="details">details</option>
                          <option value="*">*</option>
                        </select>
                      </td>
                      <td ng-if="kafkaCtrl.activeId === -1">{{acl.host}}</td>
                      <td ng-if="kafkaCtrl.activeId === acl.id">
                        <input type="text" class="form-control" id="aclHost" ng-model="kafkaCtrl.host" placeholder="Hostname (or * or subnet)">
                      </td>
                      <td ng-if="kafkaCtrl.activeId === -1">{{acl.role}}</td>
                      <td ng-if="kafkaCtrl.activeId === acl.id">
                        <select name="role_type" ng-model="kafkaCtrl.role">
                          <option value="Data Scientist">Data scientist</option>
                          <option value="Data Owner">Data owner</option>
                          <option value="*">*</option>
                        </select>
                      </td>
                      <td ng-if="kafkaCtrl.activeId === -1">{{acl.shared}}</td>
                      <td ng-if="kafkaCtrl.activeId === acl.id">
                        <select name="role_type" ng-model="kafkaCtrl.role">
                          <option value="Data Scientist">Data scientist</option>
                          <option value="Data Owner">Data owner</option>
                          <option value="*">*</option>
                        </select>
                      </td>
                      <td>
                        <button ng-if="kafkaCtrl.activeId === -1" type="button" ng-click="kafkaCtrl.removeAcl(row.id, acl.id)" class="btn btn-sm btn-danger">
                          <i class="glyphicon glyphicon-remove">
                          </i>
                        </button>
                        <button ng-if="kafkaCtrl.activeId === acl.id" type="button" ng-click="kafkaCtrl.removeAcl(row.id, acl.id)" class="btn btn-sm btn-danger">
                          <i class="glyphicon glyphicon-remove">
                          </i>
                        </button>
                      </td>
                      <td ng-if="kafkaCtrl.activeId === -1 || kafkaCtrl.activeId === acl.id">
                        <button ng-show="kafkaCtrl.activeId === acl.id" type="button" ng-click="kafkaCtrl.activeId = -1;" class="btn btn-sm btn-warning">
                          Save ACL
                        </button>
                        <button ng-show="kafkaCtrl.activeId === -1" type="button" ng-click="kafkaCtrl.selectAcl(acl);" class="btn btn-sm btn-primary">
                          Edit ACL
                        </button>
                      </td>
                    </tr>
                  </table>
                  <br ng-show="row.isSelected">
                  <br ng-show="row.isSelected">
                  <div class="col-sm-2">
                    <button style="margin-left: -20px" ng-show="row.isSelected" type="button" 
                            ng-click="kafkaCtrl.shareTopic(row.id)" class="btn btn-default btn-success btn-block">
                      Share<i style="margin-left: 10px" class="glyphicon glyphicon-share-alt">
                      </i>
                    </button>
                  </div>
                  <br ng-show="row.isSelected">
                  <br ng-show="row.isSelected">

                  <table ng-show="row.isSelected" st-table="rowCollection" class="table table-striped col-sm-4">
                    <thead ng-show="row.shares.length > 0">
                      <tr>
                        <th class="col-sm-10">Shared with Project</th>
                        <th class="col-sm-1">Unshare</th>
                      </tr>
                    </thead>
                    <tr ng-repeat="proj in row.shares">
                      <td>{{proj.proj_name}}</td>
                      <td>
                        <button type="button" ng-click="kafkaCtrl.unshareTopic(row.id, proj.proj_name)" class="btn btn-sm btn-danger">
                          <i class="glyphicon glyphicon-remove">
                          </i>
                        </button>
                      </td>
                    </tr>
                  </table>
                  <br ng-show="row.isSelected">


                </td>
                <td class="col-sm-1">
                  <button  type="button" ng-click="kafkaCtrl.removeTopic(row.name)" class="btn btn-sm btn-danger">
                    <i class="glyphicon glyphicon-remove-circle">
                    </i>
                  </button>
                  
                </td>
                <td class="col-sm-1">
                  <button type="button" ng-show="!row.isSelected" ng-click="row.isSelected = !row.isSelected; kafkaCtrl.activeId = -1;" class="btn btn-sm btn-primary">
                    Select
                  </button>
                  <button type="button" ng-show="row.isSelected" ng-click="row.isSelected = !row.isSelected; kafkaCtrl.activeId = -1;" class="btn btn-sm btn-warning">
                    Deselect
                  </button>

                </td>
              </tr>
            </tbody>
          </table>

        </div>              
    </section>
  </div>
</div>